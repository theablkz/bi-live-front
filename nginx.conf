user nginx;
worker_processes auto;
error_log /var/log/nginx/error.log;
pid /run/nginx.pid;

# Load dynamic modules. See /usr/share/doc/nginx/README.dynamic.
include /usr/share/nginx/modules/*.conf;

events {
    use epoll;
    worker_connections 1024;
    multi_accept on;
}


http{
	include /etc/nginx/mime.types;

    log_format  main  '$remote_addr - $remote_user [$time_local] "$request" '
                      '$status $body_bytes_sent "$http_referer" '
                      '"$http_user_agent" "$http_x_forwarded_for"';
    access_log  /var/log/nginx/access.log  main;
    sendfile            on;
    tcp_nopush          on;
    tcp_nodelay         on;
    keepalive_timeout   65;
    types_hash_max_size 2048;

    include             /etc/nginx/mime.types;
    default_type        application/octet-stream;

    # Load modular configuration files from the /etc/nginx/conf.d directory.
    # See http://nginx.org/en/docs/ngx_core_module.html#include
    # for more information.
    include /etc/nginx/conf.d/*.conf;


    server {
	    listen 80 ;
	    server_name nexpo.kz;
	    return 301 https://$host$request_uri;
    }
    server {
        listen       443 ssl;
        server_name  nexpo.kz;
        #root         /var/www/html/nexpo-bi;
        root         /var/www/html/nexpo-bi/new/nexpo-bi/dist;
        location / {
         	autoindex on;
	}
        ssl_certificate      "/etc/nginx/ssl/nexpo.kz.crt";
        ssl_certificate_key  "/etc/nginx/ssl/_.nexpo.kz_key.key";
        ssl_session_cache shared:SSL:1m;
        ssl_session_timeout  10m;
        ssl_stapling on;
        ssl_stapling_verify on;
        ssl_protocols TLSv1.2;
        ssl_ciphers ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES128-GCM-SHA256:ECDHE-ECDSA-AES256-GCM-SHA384:ECDHE-RSA-AES256-GCM-SHA384:ECDHE-ECDSA-CHACHA20-POLY1305:ECDHE-RSA-CHACHA20-POLY1305:DHE-RSA-AES128-GCM-SHA256:DHE-RSA-AES256-GCM-SHA384;
        ssl_prefer_server_ciphers off;
        access_log /var/log/nginx/hc.access.log;
        error_log  /var/log/nginx/hc.error.log;
        error_page 404 /404.html;
            location = /40x.html {
        }
        error_page 500 502 503 504 /50x.html;
            location = /50x.html {
        }
}

    server {
        listen 80 ;
        server_name city.nexpo.kz;
        return 301 https://$host$request_uri;
    }

    server {
        listen       443 ssl;
        server_name  city.nexpo.kz;
        root         /var/www/html/city.nexpo.kz;
        ssl_certificate      "/etc/nginx/ssl/nexpo.kz.crt";
        ssl_certificate_key  "/etc/nginx/ssl/_.nexpo.kz_key.key";
        ssl_session_cache shared:SSL:1m;
        ssl_session_timeout  10m;
        ssl_stapling on;
        ssl_stapling_verify on;
        ssl_protocols TLSv1.2;
        ssl_ciphers ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES128-GCM-SHA256:ECDHE-ECDSA-AES256-GCM-SHA384:ECDHE-RSA-AES256-GCM-SHA384:ECDHE-ECDSA-CHACHA20-POLY1305:ECDHE-RSA-CHACHA20-POLY1305:DHE-RSA-AES128-GCM-SHA256:DHE-RSA-AES256-GCM-SHA384;
        ssl_prefer_server_ciphers off;

        access_log /var/log/nginx/hc.access.log;
        error_log  /var/log/nginx/hc.error.log;


        error_page 404 /404.html;
            location = /40x.html {
        }

        error_page 500 502 503 504 /50x.html;
            location = /50x.html {
        }
}



    server {
        listen 80 ;
        server_name offersapi.bi.group www.offersapi.bi.group;
        return 301 https://$host$request_uri;
    }
    server {
        listen       443 ssl;
        server_name  offersapi.bi.group www.offersapi.bi.group;
        ssl_certificate "/etc/nginx/ssl/bi.group.crt";
        ssl_certificate_key "/etc/nginx/ssl/bi.group.key";
        ssl_session_cache shared:SSL:1m;
        ssl_session_timeout  10m;
        ssl_stapling on;
        ssl_stapling_verify on;
        ssl_protocols TLSv1.2;
        ssl_ciphers ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES128-GCM-SHA256:ECDHE-ECDSA-AES256-GCM-SHA384:ECDHE-RSA-AES256-GCM-SHA384:ECDHE-ECDSA-CHACHA20-POLY1305:ECDHE-RSA-CHACHA20-POLY1305:DHE-RSA-AES128-GCM-SHA256:DHE-RSA-AES256-GCM-SHA384;
        ssl_prefer_server_ciphers off;
	location / {
        proxy_pass http://localhost:8080;
        proxy_set_header Host $host;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Real-IP $remote_addr;
    }
    }

    server {
	    listen 80 ;
	    server_name ipoteka.bi.group;
	    return 301 https://$host$request_uri;
    }
    server {
        listen       443 ssl;
        server_name  ipoteka.bi.group;
        root         /var/www/html/ipoteka.bi.group/jyl-stroy-bi/dist;
        location / {
         	autoindex on;
	}
        ssl_certificate "/etc/nginx/ssl/bi.group.crt";
        ssl_certificate_key "/etc/nginx/ssl/bi.group.key";
        ssl_session_cache shared:SSL:1m;
        ssl_session_timeout  10m;
        ssl_stapling on;
        ssl_stapling_verify on;
        ssl_protocols TLSv1.2;
        ssl_ciphers ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES128-GCM-SHA256:ECDHE-ECDSA-AES256-GCM-SHA384:ECDHE-RSA-AES256-GCM-SHA384:ECDHE-ECDSA-CHACHA20-POLY1305:ECDHE-RSA-CHACHA20-POLY1305:DHE-RSA-AES128-GCM-SHA256:DHE-RSA-AES256-GCM-SHA384;
        ssl_prefer_server_ciphers off;
        access_log /var/log/nginx/hc.access.log;
        error_log  /var/log/nginx/hc.error.log;
        error_page 404 /404.html;
            location = /40x.html {
        }
        error_page 500 502 503 504 /50x.html;
            location = /50x.html {
        }
}
    server {
	    server_name ipoteka.nova-city.kz www.ipoteka.nova-city.kz;
	    root         /var/www/html/ipoteka.nova-city.kz/nova-bi/dist;
	    #return 301 https://$host$request_uri;

    listen 443 ssl; # managed by Certbot
    ssl_certificate /etc/letsencrypt/live/ipoteka.nova-city.kz/fullchain.pem; # managed by Certbot
    ssl_certificate_key /etc/letsencrypt/live/ipoteka.nova-city.kz/privkey.pem; # managed by Certbot
    include /etc/letsencrypt/options-ssl-nginx.conf; # managed by Certbot
    ssl_dhparam /etc/letsencrypt/ssl-dhparams.pem; # managed by Certbot

}


    server {
    if ($host = ipoteka.nova-city.kz) {
        return 301 https://$host$request_uri;
    } # managed by Certbot


	    listen 80 ;
	    server_name ipoteka.nova-city.kz www.ipoteka.nova-city.kz;
    return 404; # managed by Certbot


}






    server {
        listen 80 ;
        server_name vstretimsya-doma.bi.group www.vstretimsya-doma.bi.group;
        return 301 https://$host$request_uri;
    }
    server {
        listen       443 ssl;
        server_name  vstretimsya-doma.bi.group www.vstretimsya-doma.bi.group;
        root         /var/www/html/vstretimsya-doma.bi.group/weekly-bi/dist/;
        location / {
            autoindex on;
    }
        ssl_certificate "/etc/nginx/ssl/bi.group.crt";
        ssl_certificate_key "/etc/nginx/ssl/bi.group.key";
        ssl_session_cache shared:SSL:1m;
        ssl_session_timeout  10m;
        ssl_stapling on;
        ssl_stapling_verify on;
        ssl_protocols TLSv1.2;
        ssl_ciphers ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES128-GCM-SHA256:ECDHE-ECDSA-AES256-GCM-SHA384:ECDHE-RSA-AES256-GCM-SHA384:ECDHE-ECDSA-CHACHA20-POLY1305:ECDHE-RSA-CHACHA20-POLY1305:DHE-RSA-AES128-GCM-SHA256:DHE-RSA-AES256-GCM-SHA384;
        ssl_prefer_server_ciphers off;
        access_log /var/log/nginx/hc.access.log;
        error_log  /var/log/nginx/hc.error.log;
        error_page 404 /404.html;
            location = /40x.html {
        }
        error_page 500 502 503 504 /50x.html;
            location = /50x.html {
        }
    }










    server {
        listen 80;
        server_name ap-presidents-park.bi.group;
        return 301 https://$host$request_uri;
    }
    server {
        listen       443 ssl;
        server_name  ap-presidents-park.bi.group;
        root         /var/www/html/ap-presidents-park.bi.group/public;
        index index.php index.html index.htm;

        location /ap/api/static {
            alias /var/www/html/ap_back/static;
        }
        location /ap/api {
            proxy_set_header Host $host;
            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
            proxy_set_header X-Real-IP $remote_addr;
            proxy_pass http://unix:/var/www/html/ap_back/bimail.sock;
        }
        location /ap/admin {
            proxy_set_header Host $host;
            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
            proxy_set_header X-Real-IP $remote_addr;
            proxy_pass http://unix:/var/www/html/ap_back/bimail.sock;
        }


        location / {
            try_files $uri $uri/ /index.php?$query_string;
        }
        # Remove trailing slash to please routing system.
        # if (!-d $request_filename) {
        #     rewrite     ^/(.+)/$ /$1 permanent;
        # }

        # PHP FPM configuration.
        location ~* \.php$ {
                fastcgi_pass                    unix:/var/run/php-fpm/php-fpm.sock;
                fastcgi_index                   index.php;
                fastcgi_split_path_info         ^(.+\.php)(.*)$;
                include                         /etc/nginx/fastcgi_params;
                fastcgi_param                   SCRIPT_FILENAME $document_root$fastcgi_script_name;
        }

        # We don't need .ht files with nginx.
        location ~ /\.ht {
                deny all;
        }

        # Set header expirations on per-project basis
        location ~* \.(?:ico|css|js|jpe?g|JPG|png|svg|woff)$ {
                expires 365d;

        }

        ssl_certificate "/etc/nginx/ssl/bi.group.crt";
        ssl_certificate_key "/etc/nginx/ssl/bi.group.key";
        ssl_session_cache shared:SSL:1m;
        ssl_session_timeout  10m;
        ssl_stapling on;
        ssl_stapling_verify on;
        ssl_protocols TLSv1.2;
        ssl_ciphers ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES128-GCM-SHA256:ECDHE-ECDSA-AES256-GCM-SHA384:ECDHE-RSA-AES256-GCM-SHA384:ECDHE-ECDSA-CHACHA20-POLY1305:ECDHE-RSA-CHACHA20-POLY1305:DHE-RSA-AES128-GCM-SHA256:DHE-RSA-AES256-GCM-SHA384;
        ssl_prefer_server_ciphers off;
        access_log /var/log/nginx/hc.access.log;
        error_log  /var/log/nginx/hc.error.log;
        error_page 404 /404.html;
            location = /40x.html {
        }
        error_page 500 502 503 504 /50x.html;
            location = /50x.html {
        }
}


    server {
        listen 80 ;
        server_name greenline.bi.group;
        return 301 https://$host$request_uri;
    }
    server {
        listen       443 ssl;
        server_name  greenline.bi.group;
        root         /var/www/html/greenline.bi.group;
        location / {
            autoindex on;
    }
        ssl_certificate "/etc/nginx/ssl/bi.group.crt";
        ssl_certificate_key "/etc/nginx/ssl/bi.group.key";
        ssl_session_cache shared:SSL:1m;
        ssl_session_timeout  10m;
        ssl_stapling on;
        ssl_stapling_verify on;
        ssl_protocols TLSv1.2;
        ssl_ciphers ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES128-GCM-SHA256:ECDHE-ECDSA-AES256-GCM-SHA384:ECDHE-RSA-AES256-GCM-SHA384:ECDHE-ECDSA-CHACHA20-POLY1305:ECDHE-RSA-CHACHA20-POLY1305:DHE-RSA-AES128-GCM-SHA256:DHE-RSA-AES256-GCM-SHA384;
        ssl_prefer_server_ciphers off;
        access_log /var/log/nginx/hc.access.log;
        error_log  /var/log/nginx/hc.error.log;
        error_page 404 /404.html;
            location = /40x.html {
        }
        error_page 500 502 503 504 /50x.html;
            location = /50x.html {
        }
}

    server {
        server_name greenline.org.kz;
        root         /var/www/html/greenline.org.kz;

    listen 443 ssl; # managed by Certbot
    ssl_certificate /etc/letsencrypt/live/greenline.org.kz/fullchain.pem; # managed by Certbot
    ssl_certificate_key /etc/letsencrypt/live/greenline.org.kz/privkey.pem; # managed by Certbot
    include /etc/letsencrypt/options-ssl-nginx.conf; # managed by Certbot
    ssl_dhparam /etc/letsencrypt/ssl-dhparams.pem; # managed by Certbot

}


    #server {
     #   listen 80 ;
     #   server_name newyear.bi.group;
     #   return 301 https://$host$request_uri;
    #}
    #server {
    ##    listen       443 ssl;
    #    server_name  newyear.bi.group;
     #   #root         /var/www/html/newyear.bi.group;
       # location / {
      #  root /var/www/html/newyear.bi.group;
       # index index.html;
        #try_files $uri $uri/ /index.html;
     #   proxy_pass https://newyear.bi.group:3001;
      #  proxy_http_version 1.1;
      #  proxy_set_header Upgrade $http_upgrade;
      #  proxy_set_header Connection 'upgrade';
       # proxy_set_header Host $host;
       # proxy_cache_bypass $http_upgrade;
    #}
      #  ssl_certificate "/etc/nginx/ssl/bi.group.crt";
       # ssl_certificate_key "/etc/nginx/ssl/bi.group.key";
      ##  ssl_session_cache shared:SSL:1m;
      #  ssl_session_timeout  10m;
      #  ssl_stapling on;
      #  ssl_stapling_verify on;
      #  ssl_protocols TLSv1.2;
     #   ssl_ciphers ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES128-GCM-SHA256:ECDHE-ECDSA-AES256-GCM-SHA384:ECDHE-RSA-AES256-GCM-SHA384:ECDHE-ECDSA-CHACHA20-POLY1305:ECDHE-RSA-CHACHA20-POLY1305:DHE-RSA-AES128-GCM-SHA256:DHE-RSA-AES256-GCM-SHA384;
      #  ssl_prefer_server_ciphers off;
     #   access_log /var/log/nginx/hc.access.log;
     #   error_log  /var/log/nginx/hc.error.log;
     ##   error_page 404 /404.html;
     #       location = /40x.html {
     #   }
      #  error_page 500 502 503 504 /50x.html;
     #       location = /50x.html {
     #   }
     #   location ~ /.well-known {
     #   allow all;
    #    }
#}


     server {
        listen 80 ;
        server_name offers.bi.group www.offers.bi.group;
        return 301 https://$host$request_uri;
    }
    server {
        listen       443 ssl;
        server_name  offers.bi.group www.offers.bi.group;
        root         /var/www/html/offers.bi.group;
        location / {
            autoindex on;
    }
        ssl_certificate "/etc/nginx/ssl/bi.group.crt";
        ssl_certificate_key "/etc/nginx/ssl/bi.group.key";
        ssl_session_cache shared:SSL:1m;
        ssl_session_timeout  10m;
        ssl_stapling on;
        ssl_stapling_verify on;
        ssl_protocols TLSv1.2;
        ssl_ciphers ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES128-GCM-SHA256:ECDHE-ECDSA-AES256-GCM-SHA384:ECDHE-RSA-AES256-GCM-SHA384:ECDHE-ECDSA-CHACHA20-POLY1305:ECDHE-RSA-CHACHA20-POLY1305:DHE-RSA-AES128-GCM-SHA256:DHE-RSA-AES256-GCM-SHA384;
        ssl_prefer_server_ciphers off;
        access_log /var/log/nginx/hc.access.log;
        error_log  /var/log/nginx/hc.error.log;
        error_page 404 /404.html;
            location = /40x.html {
        }
        error_page 500 502 503 504 /50x.html;
            location = /50x.html {
        }
}


     server {
        listen 80 ;
        server_name aktau-riviera.bi.group;
        return 301 https://$host$request_uri;
    }
    server {
        listen       443 ssl;
        server_name  aktau-riviera.bi.group;
        root         /var/www/html/aktau-riviera.bi.group;
        location / {
            autoindex on;
    }
        ssl_certificate "/etc/nginx/ssl/bi.group.crt";
        ssl_certificate_key "/etc/nginx/ssl/bi.group.key";
        ssl_session_cache shared:SSL:1m;
        ssl_session_timeout  10m;
        ssl_stapling on;
        ssl_stapling_verify on;
        ssl_protocols TLSv1.2;
        ssl_ciphers ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES128-GCM-SHA256:ECDHE-ECDSA-AES256-GCM-SHA384:ECDHE-RSA-AES256-GCM-SHA384:ECDHE-ECDSA-CHACHA20-POLY1305:ECDHE-RSA-CHACHA20-POLY1305:DHE-RSA-AES128-GCM-SHA256:DHE-RSA-AES256-GCM-SHA384;
        ssl_prefer_server_ciphers off;
        access_log /var/log/nginx/hc.access.log;
        error_log  /var/log/nginx/hc.error.log;
        error_page 404 /404.html;
            location = /40x.html {
        }
        error_page 500 502 503 504 /50x.html;
            location = /50x.html {
        }
}





     server {
        listen 80 ;
        server_name pn.bi.group;
        return 301 https://$host$request_uri;
    }
    server {
        listen       443 ssl;
        server_name  pn.bi.group;
        root         /var/www/html/pn.bi.group/newpn;
        location / {
            autoindex on;
    }
        ssl_certificate "/etc/nginx/ssl/bi.group.crt";
        ssl_certificate_key "/etc/nginx/ssl/bi.group.key";
        ssl_session_cache shared:SSL:1m;
        ssl_session_timeout  10m;
        ssl_stapling on;
        ssl_stapling_verify on;
        ssl_protocols TLSv1.2;
        ssl_ciphers ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES128-GCM-SHA256:ECDHE-ECDSA-AES256-GCM-SHA384:ECDHE-RSA-AES256-GCM-SHA384:ECDHE-ECDSA-CHACHA20-POLY1305:ECDHE-RSA-CHACHA20-POLY1305:DHE-RSA-AES128-GCM-SHA256:DHE-RSA-AES256-GCM-SHA384;
        ssl_prefer_server_ciphers off;
        access_log /var/log/nginx/hc.access.log;
        error_log  /var/log/nginx/hc.error.log;
        error_page 404 /404.html;
            location = /40x.html {
        }
        error_page 500 502 503 504 /50x.html;
            location = /50x.html {
        }
}




     server {
        listen 80 ;
        server_name ipoteka-sberbank.bi.group;
        return 301 https://$host$request_uri;
    }
    server {
        listen       443 ssl;
        server_name  ipoteka-sberbank.bi.group;
        root         /var/www/html/ipoteka-sberbank.bi.group;
        location / {
            autoindex on;
    }
        ssl_certificate "/etc/nginx/ssl/bi.group.crt";
        ssl_certificate_key "/etc/nginx/ssl/bi.group.key";
        ssl_session_cache shared:SSL:1m;
        ssl_session_timeout  10m;
        ssl_stapling on;
        ssl_stapling_verify on;
        ssl_protocols TLSv1.2;
        ssl_ciphers ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES128-GCM-SHA256:ECDHE-ECDSA-AES256-GCM-SHA384:ECDHE-RSA-AES256-GCM-SHA384:ECDHE-ECDSA-CHACHA20-POLY1305:ECDHE-RSA-CHACHA20-POLY1305:DHE-RSA-AES128-GCM-SHA256:DHE-RSA-AES256-GCM-SHA384;
        ssl_prefer_server_ciphers off;
        access_log /var/log/nginx/hc.access.log;
        error_log  /var/log/nginx/hc.error.log;
        error_page 404 /404.html;
            location = /40x.html {
        }
        error_page 500 502 503 504 /50x.html;
            location = /50x.html {
        }
}


     server {
        listen 80 ;
        server_name ipoteka-halyk.bi.group;
        return 301 https://$host$request_uri;
    }
    server {
        listen       443 ssl;
        server_name  ipoteka-halyk.bi.group;
        root         /var/www/html/ipoteka-halyk.bi.group;
        location / {
            autoindex on;
    }
        ssl_certificate "/etc/nginx/ssl/bi.group.crt";
        ssl_certificate_key "/etc/nginx/ssl/bi.group.key";
        ssl_session_cache shared:SSL:1m;
        ssl_session_timeout  10m;
        ssl_stapling on;
        ssl_stapling_verify on;
        ssl_protocols TLSv1.2;
        ssl_ciphers ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES128-GCM-SHA256:ECDHE-ECDSA-AES256-GCM-SHA384:ECDHE-RSA-AES256-GCM-SHA384:ECDHE-ECDSA-CHACHA20-POLY1305:ECDHE-RSA-CHACHA20-POLY1305:DHE-RSA-AES128-GCM-SHA256:DHE-RSA-AES256-GCM-SHA384;
        ssl_prefer_server_ciphers off;
        access_log /var/log/nginx/hc.access.log;
        error_log  /var/log/nginx/hc.error.log;
        error_page 404 /404.html;
            location = /40x.html {
        }
        error_page 500 502 503 504 /50x.html;
            location = /50x.html {
        }
}


     server {
        listen 80 ;
        server_name amir.bi.group;
        return 301 https://$host$request_uri;
    }
    server {
        listen       443 ssl;
        server_name  amir.bi.group;
        root         /var/www/html/amir.bi.group;
        location / {
            autoindex on;
    }
        ssl_certificate "/etc/nginx/ssl/bi.group.crt";
        ssl_certificate_key "/etc/nginx/ssl/bi.group.key";
        ssl_session_cache shared:SSL:1m;
        ssl_session_timeout  10m;
        ssl_stapling on;
        ssl_stapling_verify on;
        ssl_protocols TLSv1.2;
        ssl_ciphers ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES128-GCM-SHA256:ECDHE-ECDSA-AES256-GCM-SHA384:ECDHE-RSA-AES256-GCM-SHA384:ECDHE-ECDSA-CHACHA20-POLY1305:ECDHE-RSA-CHACHA20-POLY1305:DHE-RSA-AES128-GCM-SHA256:DHE-RSA-AES256-GCM-SHA384;
        ssl_prefer_server_ciphers off;
        access_log /var/log/nginx/hc.access.log;
        error_log  /var/log/nginx/hc.error.log;
        error_page 404 /404.html;
            location = /40x.html {
        }
        error_page 500 502 503 504 /50x.html;
            location = /50x.html {
        }
}


    server {
        listen 80;
        server_name backend.bi.group;
        return 301 https://$host$request_uri;
    }
    server {
        listen       443 ssl;
        server_name  backend.bi.group;
        root         /var/www/html/backend.bi.group/public;
        index index.php index.html index.htm;

        location /ap/api/static {
            alias /var/www/html/backend.bi.group;
        }
        location /ap/api {
            proxy_set_header Host $host;
            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
            proxy_set_header X-Real-IP $remote_addr;
            proxy_pass http://unix:/var/www/html/ap_back/bimail.sock;
        }
        location /ap/admin {
            proxy_set_header Host $host;
            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
            proxy_set_header X-Real-IP $remote_addr;
            proxy_pass http://unix:/var/www/html/ap_back/bimail.sock;
        }


        location / {
            try_files $uri $uri/ /index.php?$query_string;
        }
        # Remove trailing slash to please routing system.
        # if (!-d $request_filename) {
        #     rewrite     ^/(.+)/$ /$1 permanent;
        # }

        # PHP FPM configuration.
        location ~* \.php$ {
                fastcgi_pass                    unix:/var/run/php-fpm/php-fpm.sock;
                fastcgi_index                   index.php;
                fastcgi_split_path_info         ^(.+\.php)(.*)$;
                include                         /etc/nginx/fastcgi_params;
                fastcgi_param                   SCRIPT_FILENAME $document_root$fastcgi_script_name;
        }

        # We don't need .ht files with nginx.
        location ~ /\.ht {
                deny all;
        }

        # Set header expirations on per-project basis
        location ~* \.(?:ico|css|js|jpe?g|JPG|png|svg|woff)$ {
                expires 365d;

        }

        ssl_certificate "/etc/nginx/ssl/bi.group.crt";
        ssl_certificate_key "/etc/nginx/ssl/bi.group.key";
        ssl_session_cache shared:SSL:1m;
        ssl_session_timeout  10m;
        ssl_stapling on;
        ssl_stapling_verify on;
        ssl_protocols TLSv1.2;
        ssl_ciphers ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES128-GCM-SHA256:ECDHE-ECDSA-AES256-GCM-SHA384:ECDHE-RSA-AES256-GCM-SHA384:ECDHE-ECDSA-CHACHA20-POLY1305:ECDHE-RSA-CHACHA20-POLY1305:DHE-RSA-AES128-GCM-SHA256:DHE-RSA-AES256-GCM-SHA384;
        ssl_prefer_server_ciphers off;
        access_log /var/log/nginx/hc.access.log;
        error_log  /var/log/nginx/hc.error.log;
        error_page 404 /404.html;
            location = /40x.html {
        }
        error_page 500 502 503 504 /50x.html;
            location = /50x.html {
        }
}


    server {
    if ($host = greenline.org.kz) {
        return 301 https://$host$request_uri;
    } # managed by Certbot


        listen 80;
        server_name greenline.org.kz;
    return 404; # managed by Certbot


}


     server {
        listen 80 ;
        server_name catalog.bi.group;
        return 301 https://$host$request_uri;
    }
    server {
        listen       443 ssl;
        server_name  catalog.bi.group;
        root         /var/www/html/catalog.bi.group/bi-catalog-back;
        location / {
            autoindex on;
    }
        ssl_certificate "/etc/nginx/ssl/bi.group.crt";
        ssl_certificate_key "/etc/nginx/ssl/bi.group.key";
        ssl_session_cache shared:SSL:1m;
        ssl_session_timeout  10m;
        ssl_stapling on;
        ssl_stapling_verify on;
        ssl_protocols TLSv1.2;
        ssl_ciphers ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES128-GCM-SHA256:ECDHE-ECDSA-AES256-GCM-SHA384:ECDHE-RSA-AES256-GCM-SHA384:ECDHE-ECDSA-CHACHA20-POLY1305:ECDHE-RSA-CHACHA20-POLY1305:DHE-RSA-AES128-GCM-SHA256:DHE-RSA-AES256-GCM-SHA384;
        ssl_prefer_server_ciphers off;
        access_log /var/log/nginx/hc.access.log;
        error_log  /var/log/nginx/hc.error.log;
        error_page 404 /404.html;
            location = /40x.html {
        }
        error_page 500 502 503 504 /50x.html;
            location = /50x.html {
        }
}


    server {
        listen 80 ;
        server_name catalog.bi.group;
        return 301 https://$host$request_uri;
    }
    server {
        listen       443 ssl;
        server_name  catalog-api.bi.group;
        root         /var/www/html/catalog-api.bi.group/bi-catalog-back;
        ssl_certificate "/etc/nginx/ssl/bi.group.crt";
        ssl_certificate_key "/etc/nginx/ssl/bi.group.key";
        ssl_session_cache shared:SSL:1m;
        ssl_session_timeout  10m;
        ssl_stapling on;
        ssl_stapling_verify on;
        ssl_protocols TLSv1.2;
        ssl_ciphers ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES128-GCM-SHA256:ECDHE-ECDSA-AES256-GCM-SHA384:ECDHE-RSA-AES256-GCM-SHA384:ECDHE-ECDSA-CHACHA20-POLY1305:ECDHE-RSA-CHACHA20-POLY1305:DHE-RSA-AES128-GCM-SHA256:DHE-RSA-AES256-GCM-SHA384;
        ssl_prefer_server_ciphers off;
        access_log /var/log/nginx/hc.access.log;
        error_log  /var/log/nginx/hc.error.log;
        error_page 404 /404.html;
        location = /40x.html {
        }
        error_page 500 502 503 504 /50x.html;
        location = /50x.html {
        }
        location / {
            proxy_http_version 1.1;
            proxy_cache_bypass $http_upgrade;
            proxy_set_header Upgrade $http_upgrade;
            proxy_set_header Connection 'upgrade';
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
            proxy_set_header X-Forwarded-Proto $scheme;
            proxy_pass http://localhost:3001;
        }

    }

    server {
        server_name catalog.nova-city.kz;
        root         /var/www/html/catalog.bi.group/bi-catalog-back;
        listen 443 ssl; # managed by Certbot
        ssl_certificate /etc/letsencrypt/live/catalog.nova-city.kz/fullchain.pem; # managed by Certbot
        ssl_certificate_key /etc/letsencrypt/live/catalog.nova-city.kz/privkey.pem; # managed by Certbot
        include /etc/letsencrypt/options-ssl-nginx.conf; # managed by Certbot
        ssl_dhparam /etc/letsencrypt/ssl-dhparams.pem; # managed by Certbot
    }


     server {
        server_name catalog-api.nova-city.kz;
        root         /var/www/html/catalog-api.nova-city.kz;
    listen 443 ssl; # managed by Certbot
    ssl_certificate /etc/letsencrypt/live/catalog-api.nova-city.kz/fullchain.pem; # managed by Certbot
    ssl_certificate_key /etc/letsencrypt/live/catalog-api.nova-city.kz/privkey.pem; # managed by Certbot
    include /etc/letsencrypt/options-ssl-nginx.conf; # managed by Certbot
    ssl_dhparam /etc/letsencrypt/ssl-dhparams.pem; # managed by Certbot

}



     server {
    if ($host = catalog.nova-city.kz) {
        return 301 https://$host$request_uri;
    } # managed by Certbot


        listen 80 ;
        server_name catalog.nova-city.kz;
    return 404; # managed by Certbot


}


     server {
    if ($host = catalog-api.nova-city.kz) {
        return 301 https://$host$request_uri;
    } # managed by Certbot


        listen 80 ;
        server_name catalog-api.nova-city.kz;
    return 404; # managed by Certbot


}}


#server {
#        listen 80;
#        server_name catalog.bi.group;
#        listen [::]:80 default_server;
#        root /var/www/html;
#        index index.html index.htm index.nginx-debian.html;
#        server_name hellonode;
#
#        location ^~ /assets/ {
#                gzip_static on;
#                expires 12h;
#                add_header Cache-Control public;
#        }

#	location / {
#                proxy_http_version 1.1;
#                proxy_cache_bypass $http_upgrade;
#                proxy_set_header Upgrade $http_upgrade;
#                proxy_set_header Connection 'upgrade';
#                proxy_set_header Host $host;
#                proxy_set_header X-Real-IP $remote_addr;
#                proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
#                proxy_set_header X-Forwarded-Proto $scheme;
#                proxy_pass http://localhost:3001;
 #       }
#}
#}
